@model Appointment

<h2>Créer un rendez-vous</h2>

<form asp-action="Create" method="post">
    <div>
        <label>Spécialité</label>
        <select name="speciality" id="specialitySelect">
            @foreach (var speciality in ViewBag.Specialities)
            {
                <option value="@speciality">@speciality</option>
            }
        </select>
    </div>

    <div id="professionalsContainer">
        <!-- Les professionnels seront chargés ici via AJAX -->
    </div>

    <div>
        <label asp-for="Date">Date et heure</label>
        <input asp-for="Date" type="datetime-local" />
        <span asp-validation-for="Date"></span>
    </div>

    <div>
        <label asp-for="Description">Description</label>
        <textarea asp-for="Description"></textarea>
        <span asp-validation-for="Description"></span>
    </div>

    <button type="submit">Créer le rendez-vous</button>
</form>

@section Scripts {
    <script>
        document.getElementById('specialitySelect').addEventListener('change', function() {
            var speciality = this.value;

            fetch('/Appointment/GetProfessionals?speciality=' + speciality)
                .then(response => response.json())
                .then(data => {
                    var container = document.getElementById('professionalsContainer');
                    container.innerHTML = '';

                    if (data.length > 0) {
                        var select = document.createElement('select');
                        select.name = 'professionalId';

                        data.forEach(professional => {
                            var option = document.createElement('option');
                            option.value = professional.id;
                            option.textContent = professional.firstName + ' ' + professional.lastName;
                            select.appendChild(option);
                        });

                        container.appendChild(select);
                    } else {
                        container.innerHTML = '<p>Aucun professionnel disponible pour cette spécialité</p>';
                    }
                });
        });

        // Déclencher le changement au chargement de la page
        document.getElementById('specialitySelect').dispatchEvent(new Event('change'));
    </script>
}